<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.yeast.mappers.branch.STableBMapper">
    <select id="getAllEmployees" resultType="com.kh.yeast.domain.entity.Employee">
        SELECT *
        FROM MEMBER;
    </select>
    <select id="findEmployeesByName" parameterType="String" resultType="com.kh.yeast.domain.entity.Employee">
        SELECT
        m.USER_NO AS userNo,
        m.USER_ID AS userId,
        m.USER_NAME AS userName,
        m.EMAIL,
        m.PHONE,
        m.GENDER,
        m.POSITION_NO AS positionNo,
        m.BUSINESS_NO AS businessNo,
        m.SALARY,
        m.CREATE_DATE AS createDate,
        h.headName
        FROM MEMBER m
        LEFT JOIN (
        SELECT mm.BUSINESS_NO, mm.USER_NAME AS headName
        FROM MEMBER mm
        JOIN POSITION p ON mm.POSITION_NO = p.POSITION_NO
        WHERE p.ROLE = 1
        ) h ON m.BUSINESS_NO = h.BUSINESS_NO
        WHERE m.USER_NAME LIKE '%' || #{userName} || '%'
    </select>
</mapper>
